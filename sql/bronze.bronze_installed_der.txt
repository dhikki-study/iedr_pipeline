CREATE TABLE workspace.bronze.bronze_installed_der (
  project_id STRING COMMENT 'Project identifier (ProjectID / DER_ID)',
  project_circuit_id STRING COMMENT 'Circuit ID from utility1 (ProjectCircuitID)',
  der_interconn_loc STRING COMMENT 'DER interconnection location (NULL for utility1 / DER_INTERCONNECTION_LOCATION)',
  utility_id STRING NOT NULL COMMENT 'Source utility identifier',
  project_type STRING COMMENT 'Project type code (RESPHOTO, ComWind, Transmission / DER_TYPE)',
  nameplate_rating DOUBLE COMMENT 'Total project nameplate capacity in kW (NamePlateRating / DER_NAMEPLATE_RATING)',
  street_address STRING COMMENT 'Service address - NULL for utility1, present for utility2 (SERVICE_STREET_ADDRESS)',
  Hybrid STRING COMMENT 'Hybrid system capacity in kW (utility1 only)',
  SolarPV DOUBLE COMMENT 'Solar PV capacity in kW (utility1 only)',
  EnergyStorageSystem DOUBLE COMMENT 'Energy storage capacity in kW (utility1 only)',
  Wind DOUBLE COMMENT 'Wind capacity in kW (utility1 only)',
  MicroTurbine DOUBLE COMMENT 'Micro turbine capacity in kW (utility1 only)',
  SynchronousGenerator DOUBLE COMMENT 'Synchronous generator capacity in kW (utility1 only)',
  InductionGenerator DOUBLE COMMENT 'Induction generator capacity in kW (utility1 only)',
  FarmWaste DOUBLE COMMENT 'Farm waste/biogas capacity in kW (utility1 only)',
  FuelCell DOUBLE COMMENT 'Fuel cell capacity in kW (utility1 only)',
  CombinedHeatandPower DOUBLE COMMENT 'Combined heat and power capacity in kW (utility1 only)',
  GasTurbine DOUBLE COMMENT 'Gas turbine capacity in kW (utility1 only)',
  Hydro DOUBLE COMMENT 'Hydroelectric capacity in kW (utility1 only)',
  InternalCombustionEngine DOUBLE COMMENT 'Internal combustion engine capacity in kW (utility1 only)',
  SteamTurbine DOUBLE COMMENT 'Steam turbine capacity in kW (utility1 only)',
  Other DOUBLE COMMENT 'Other DER type capacity in kW (utility1 only)',
  total_charges_cesir DOUBLE COMMENT 'Total CESIR charges (TotalChargesCESIR)',
  total_charges_construction DOUBLE COMMENT 'Total construction charges (TotalChargesConstruction)',
  cesir_est DOUBLE COMMENT 'CESIR estimate (CESIR_EST)',
  system_upgrade_est DOUBLE COMMENT 'System upgrade estimate (SystemUpgrade_EST)',
  interconnection_cost DOUBLE COMMENT 'Interconnection cost - utility2 (INTERCONNECTION_COST)',
  ingestion_timestamp TIMESTAMP NOT NULL COMMENT 'When this record was loaded into Bronze',
  source_file STRING NOT NULL COMMENT 'Original source filename')
USING delta
PARTITIONED BY (utility_id)
COMMENT 'Bronze layer - Installed DER data in WIDE format (no unpivoting until Silver)'
TBLPROPERTIES (
  'delta.autoOptimize.autoCompact' = 'true',
  'delta.autoOptimize.optimizeWrite' = 'true',
  'delta.checkpoint.writeStatsAsJson' = 'false',
  'delta.checkpoint.writeStatsAsStruct' = 'true',
  'delta.enableChangeDataFeed' = 'true',
  'delta.enableDeletionVectors' = 'true',
  'delta.enableRowTracking' = 'true',
  'delta.feature.appendOnly' = 'supported',
  'delta.feature.changeDataFeed' = 'supported',
  'delta.feature.deletionVectors' = 'supported',
  'delta.feature.domainMetadata' = 'supported',
  'delta.feature.invariants' = 'supported',
  'delta.feature.rowTracking' = 'supported',
  'delta.minReaderVersion' = '3',
  'delta.minWriterVersion' = '7',
  'delta.parquet.compression.codec' = 'zstd')
