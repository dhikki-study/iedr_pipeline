CREATE TABLE workspace.silver.silver_planned_der (
  project_id_pk BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1) COMMENT 'Auto-incrementing unique identifier (PK)',
  project_id STRING COMMENT 'Unique project identifier',
  queue_request_id STRING COMMENT 'Queue request identifier',
  project_circuit_id STRING COMMENT 'Circuit/feeder where project is planned',
  der_interconn_loc STRING COMMENT 'DER interconnection location',
  utility_id STRING NOT NULL COMMENT 'Utility identifier',
  project_type STRING COMMENT 'Type of DER project',
  nameplate_rating DOUBLE COMMENT 'Nameplate rating capacity (kW)',
  inverter_nameplate_rating DOUBLE COMMENT 'Inverter nameplate rating (kW)',
  Hybrid STRING COMMENT 'Hybrid system indicator',
  DER_TYPE STRING COMMENT 'Type of DER (SolarPV, Wind, EnergyStorage, etc.)',
  DER_VALUE DOUBLE COMMENT 'Planned capacity value for this DER type (kW)',
  in_service_date TIMESTAMP COMMENT 'Planned in-service date',
  completion_date TIMESTAMP COMMENT 'Expected completion date',
  project_status STRING COMMENT 'Current project status',
  status_rationale STRING COMMENT 'Rationale for current status',
  queue_position STRING COMMENT 'Queue position timestamp',
  total_mw_substation DOUBLE COMMENT 'Total MW capacity at substation',
  active BOOLEAN NOT NULL DEFAULT TRUE COMMENT 'True = current/active record, False = historical/inactive',
  ingestion_timestamp TIMESTAMP NOT NULL COMMENT 'When loaded to Silver',
  source_file STRING NOT NULL COMMENT 'Original source CSV filename')
USING delta
PARTITIONED BY (utility_id)
COMMENT 'Silver layer: Planned DER with historical tracking (Type 2 SCD, unpivoted)'
TBLPROPERTIES (
  'delta.autoOptimize.autoCompact' = 'true',
  'delta.autoOptimize.optimizeWrite' = 'true',
  'delta.checkpoint.writeStatsAsJson' = 'false',
  'delta.checkpoint.writeStatsAsStruct' = 'true',
  'delta.enableChangeDataFeed' = 'true',
  'delta.enableDeletionVectors' = 'true',
  'delta.enableRowTracking' = 'true',
  'delta.feature.allowColumnDefaults' = 'supported',
  'delta.feature.appendOnly' = 'supported',
  'delta.feature.changeDataFeed' = 'supported',
  'delta.feature.deletionVectors' = 'supported',
  'delta.feature.domainMetadata' = 'supported',
  'delta.feature.identityColumns' = 'supported',
  'delta.feature.invariants' = 'supported',
  'delta.feature.rowTracking' = 'supported',
  'delta.minReaderVersion' = '3',
  'delta.minWriterVersion' = '7',
  'delta.parquet.compression.codec' = 'zstd')
