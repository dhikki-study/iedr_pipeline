CREATE TABLE workspace.bronze.bronze_planned_der (
  project_id STRING COMMENT 'Project ID from utility1 (ProjectID) - NULL for utility2',
  queue_request_id STRING COMMENT 'Queue request ID from utility2 (INTERCONNECTION_QUEUE_REQUEST_ID) - NULL for utility1',
  project_circuit_id STRING COMMENT 'Circuit ID from utility1 (ProjectCircuitID) - NULL for utility2',
  der_interconn_loc STRING COMMENT 'DER interconnection location from utility2 (DER_INTERCONNECTION_LOCATION) - NULL for utility1',
  utility_id STRING NOT NULL COMMENT 'Source utility identifier',
  project_type STRING COMMENT 'Project type code (NRESPHOTO, ComWind / DER_TYPE)',
  nameplate_rating DOUBLE COMMENT 'Total project nameplate capacity in kW (NamePlateRating / DER_NAMEPLATE_RATING)',
  inverter_nameplate_rating DOUBLE COMMENT 'Inverter capacity - utility2 only (INVERTER_NAMEPLATE_RATING)',
  Hybrid STRING COMMENT 'Hybrid system capacity in kW (utility1 only)',
  SolarPV DOUBLE COMMENT 'Solar PV capacity in kW (utility1 only)',
  EnergyStorageSystem DOUBLE COMMENT 'Energy storage capacity in kW (utility1 only)',
  Wind DOUBLE COMMENT 'Wind capacity in kW (utility1 only)',
  MicroTurbine DOUBLE COMMENT 'Micro turbine capacity in kW (utility1 only)',
  SynchronousGenerator DOUBLE COMMENT 'Synchronous generator capacity in kW (utility1 only)',
  InductionGenerator DOUBLE COMMENT 'Induction generator capacity in kW (utility1 only)',
  FarmWaste DOUBLE COMMENT 'Farm waste/biogas capacity in kW (utility1 only)',
  FuelCell DOUBLE COMMENT 'Fuel cell capacity in kW (utility1 only)',
  CombinedHeatandPower DOUBLE COMMENT 'Combined heat and power capacity in kW (utility1 only)',
  GasTurbine DOUBLE COMMENT 'Gas turbine capacity in kW (utility1 only)',
  Hydro DOUBLE COMMENT 'Hydroelectric capacity in kW (utility1 only)',
  InternalCombustionEngine DOUBLE COMMENT 'Internal combustion engine capacity in kW (utility1 only)',
  SteamTurbine DOUBLE COMMENT 'Steam turbine capacity in kW (utility1 only)',
  Other DOUBLE COMMENT 'Other DER type capacity in kW (utility1 only)',
  in_service_date TIMESTAMP COMMENT 'Planned in-service date (InServiceDate / PLANNED_INSTALLATION_DATE)',
  completion_date TIMESTAMP COMMENT 'Completion date/time from utility1 (CompletionDate) - NULL for utility2',
  project_status STRING COMMENT 'Project status (ProjectStatus / DER_STATUS)',
  status_rationale STRING COMMENT 'Status reason - utility2 only (DER_STATUS_RATIONALE)',
  queue_position STRING COMMENT 'Position in interconnection queue (INTERCONNECTION_QUEUE_POSITION)',
  total_mw_substation DOUBLE COMMENT 'Total MW for substation - utility2 (TOTAL_MW_FOR_SUBSTATION)',
  ingestion_timestamp TIMESTAMP NOT NULL COMMENT 'When this record was loaded into Bronze',
  source_file STRING NOT NULL COMMENT 'Original source filename')
USING delta
PARTITIONED BY (utility_id)
COMMENT 'Bronze layer - Planned DER data in WIDE format (no unpivoting until Silver)'
TBLPROPERTIES (
  'delta.autoOptimize.autoCompact' = 'true',
  'delta.autoOptimize.optimizeWrite' = 'true',
  'delta.checkpoint.writeStatsAsJson' = 'false',
  'delta.checkpoint.writeStatsAsStruct' = 'true',
  'delta.enableChangeDataFeed' = 'true',
  'delta.enableDeletionVectors' = 'true',
  'delta.enableRowTracking' = 'true',
  'delta.feature.appendOnly' = 'supported',
  'delta.feature.changeDataFeed' = 'supported',
  'delta.feature.deletionVectors' = 'supported',
  'delta.feature.domainMetadata' = 'supported',
  'delta.feature.invariants' = 'supported',
  'delta.feature.rowTracking' = 'supported',
  'delta.minReaderVersion' = '3',
  'delta.minWriterVersion' = '7',
  'delta.parquet.compression.codec' = 'zstd')
